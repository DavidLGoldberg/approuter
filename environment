#! /usr/bin/env bash

# have we done this?, then we should not do it again
if [ -n "$PRE_APPROUTER_PATH" ]; then
    echo "looks like we're already set... ignoring your request"
else
    echo "setting your environment up for you...."
    # capture how the path was before we started
    export PRE_APPROUTER_PATH=$PATH
    export PRE_APPROUTER_LD_LIBRARY_PATH=$LD_LIBRARY_PATH

    HERE=`pwd`
    ROOT=${HERE}/build_output
    LD_LIBRARY_PATH=${ROOT}/lib:$PRE_APPROUTER_LD_LIBRARY_PATH
    PATH=${HERE}/bin:${ROOT}/bin:$PATH
    PATH=${ROOT}/usr/local/ssl/bin/:$PATH
    PATH=${ROOT}/sbin:$PATH
    
    function deactivate(){
        export PATH=$PRE_APPROUTER_PATH
        if [ -n "$PRE_APPROUTER_LD_LIBRARY_PATH" ]; then
            export LD_LIBRARY_PATH=$PRE_APPROUTER_LD_LIBRARY_PATH
        else
            unset LD_LIBRARY_PATH
        fi
        unset PRE_APPROUTER_LD_LIBRARY_PATH
        unset PRE_APPROUTER_PATH
        echo "I've removed the environment changes for you"
    }

    export PATH
    export LD_LIBRARY_PATH
    export -f deactivate
fi

